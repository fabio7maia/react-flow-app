const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./emptyComponent-mYdVEioj.js","./index-D4lIrffr.js","./screen1-DtBiQz1L.js","./placeholder.component-5IK4axi2.js","./logger.helper-B8kJPxwa.js","./placeholder-hEe4NFFs.css","./iframe-BF6XVz0g.js","./screen2-D01pbWWe.js","./screen3-BuOZTEkB.js"])))=>i.map(i=>d[i]);
import{R as a}from"./index-D4lIrffr.js";import{f as M,a as B,P as z,S as $,F as V,b as q,u as W}from"./placeholder.component-5IK4axi2.js";import{L as D,C as f}from"./logger.helper-B8kJPxwa.js";import{_ as N}from"./iframe-BF6XVz0g.js";class U extends a.Component{constructor(l){super(l),this.state={hasError:!1}}componentDidCatch(l,p){this.setState({...this.state,error:l,hasError:!0})}render(){const{containerErrorMessage:l}=this.props,{error:p}=this.state;return this.state.hasError?l&&l(typeof p=="object"?JSON.stringify(p):p)||null:this.props.children}}try{U.displayName="ErrorBoundary",U.__docgenInfo={description:"",displayName:"ErrorBoundary",props:{containerErrorMessage:{defaultValue:null,description:"",name:"containerErrorMessage",required:!1,type:{name:"(error: string) => ReactNode"}}}}}catch{}const _=()=>{const{currentFlowName:c,fm:l,options:p}=a.useContext(M),t=l.getFlow(c);return a.createElement(a.Fragment,null,t==null?void 0:t.render(p))};try{_.displayName="StepRender",_.__docgenInfo={description:"",displayName:"StepRender",props:{}}}catch{}const A=({error:c})=>{const l=B();return a.useEffect(()=>{l.error("UnexpectedError",{error:c})},[]),a.createElement("h1",null,"Pedimos desculpa, mas de momento nÃ£o podemos satisfazer o seu pedido!")};try{A.displayName="UnexpectedError",A.__docgenInfo={description:"",displayName:"UnexpectedError",props:{error:{defaultValue:null,description:"",name:"error",required:!0,type:{name:"string"}}}}}catch{}class J{constructor(l,p,t){this.name=l,this.loader=p,this.options=t,this.actions={}}}const g={};let G=class{constructor(l,p){this.logger=(t,...e)=>{D.log("Flow")(t,e)},this.callListeners=(t,e,o)=>{const n=t==="mount"?this.currentStepName:this.lastRenderStepName||this.currentStepName,s=this.steps[n],i={url:this.buildUrl(s),flowName:this.name,currentStepName:n,type:t,dispatch:e,options:o};this.listeners[t].forEach(r=>r(i)),this.listeners.all.forEach(r=>r(i))},this.getCurrentStepExtraInfo=()=>this.steps[this.currentStepName],this.hasPreviousStep=()=>!!(this.history.length>0||this.fromFlow),this.getPreviousStep=()=>{if(this.history.length>0){const t=this.steps[this.history[this.history.length-1]];return{flowName:this.name,name:t.name}}else if(this.fromFlow)return{flowName:this.fromFlow.flowName,name:this.fromFlow.stepName}},this.getCurrentStep=()=>{const t=this.steps[this.currentStepName];return t?{flowName:this.name,name:t.name}:void 0},this.getHistory=()=>this.history,this.getLastAction=()=>this.lastAction,this.addStep=(t,e,o)=>{const n=new J(e,t.loader,o);!this.initialStepName&&f.getValueOrDefault(o.initialStep,!1)&&(this.initialStepName=n.name),this.steps[e]=n},this.addAction=(t,e,o,n=!1)=>{if(n)this.anotherObjects=this.anotherObjects||{},this.anotherObjects[t]=this.anotherObjects[t]||{actions:{},loader:()=>a.lazy(()=>N(()=>import("./emptyComponent-mYdVEioj.js"),__vite__mapDeps([0,1]),import.meta.url)),name:t},this.anotherObjects[t].actions[e]=o;else{const s=this.steps[t];s.actions[e]=o}},this.addListener=(t,e="all")=>{this.listeners[e].push(t)},this.stepUrl=t=>{var e;return((e=t==null?void 0:t.options)==null?void 0:e.url)||t.name},this.buildUrl=t=>{let e=this.baseUrl;t=t||this.getCurrentStepExtraInfo();const o=t?this.stepUrl(t):"";return e=e.startsWith("/")?e.substring(1,e.length):e,e=e.endsWith("/")?e.substring(0,e.length-1):e,`/${e}/${o}`},this.render=t=>{var n;const e=this.currentStepName,{animation:o}=t;if(this.logger("Flow > render [start]",{currentStepName:e}),!e)return this.lastRenderStepName=e,null;if((!this.lastRenderStepName||this.lastRenderStepName!==this.currentStepName)&&this.mount(),this.lastRenderStepName=e,e&&this.steps.hasOwnProperty(e)){const s=this.steps[e],{clearHistory:i=!1}=s.options||{};i&&this.clearHistory();let r=null;(n=g[this.name])!=null&&n[s.name]?r=g[this.name][s.name]:(r=s.loader(),g[this.name]=g[this.name]||{},g[this.name][s.name]=r),this.logger("Flow > render [start]",{currentStepName:e,Screen:r});const h=o===!1?a.createElement(a.Fragment,null):o===!0?a.createElement(z,{loading:!0}):o;return a.createElement(a.Suspense,{fallback:h},a.createElement(r,null))}return null},this.start=(t,e,o,n=!1,s=void 0)=>{var h;this.logger("start",{stepName:t,fromFlow:e,options:o}),this.lastAction=void 0,this.fromFlow=this.name!==(e==null?void 0:e.flowName)?e:void 0;const i=t||this.currentStepName||this.initialStepName||this.firstStepName,{clearHistory:r=!1}=o||{};return Array.isArray(s)&&s.length>0&&(this.history=s),n&&(this.lastAction="back",this.lastRenderStepName=void 0,this.fromFlow&&this.history.length===0)?{changed:!0,currentFlowName:this.fromFlow.flowName}:this.steps.hasOwnProperty(i)?(this.currentStepName=i,(r||this.getCurrentStepExtraInfo().options.clearHistory)&&this.clearHistory(),i===((h=this.getPreviousStep())==null?void 0:h.name)&&this.removeLastStepHistory(),{changed:!0,historyUrl:this.buildUrl(),currentFlowName:this.name,currentStepName:this.currentStepName}):{changed:!1}},this.mount=()=>{this.callListeners("mount")},this.back=()=>{let t=this.history.pop();return t===this.currentStepName&&(t=this.history.pop()),t?(this.lastAction="back",this.currentStepName=t,this.callListeners("back"),{changed:!0,currentFlowName:this.name,currentStepName:this.currentStepName,historyUrl:this.buildUrl()}):this.fromFlow?(this.callListeners("backExit"),{changed:!0,currentFlowName:this.fromFlow.flowName}):{changed:!1}},this.removeLastStepHistory=()=>{this.history.length>0&&this.history.pop()},this.clearHistory=()=>{this.history=[],this.fromFlow=void 0,g[this.name]={}},this.treatHistory=t=>{var e,o,n,s,i;if(this.currentStepName){const r=this.steps[this.currentStepName];if(this.logger("Flow > treatHistory",{currentStep:r,ignoreHistory:(e=r.options)==null?void 0:e.ignoreHistory}),f.getValueOrDefault((o=r.options)==null?void 0:o.clearHistory,!1)&&this.clearHistory(),f.getValueOrDefault((n=r.options)==null?void 0:n.ignoreHistory,!1)||this.history.push(this.currentStepName),!f.getValueOrDefault((s=r.options)==null?void 0:s.allowCyclicHistory,!1)&&this.history.filter(u=>u===this.currentStepName).length>0){const u=this.history.findIndex(d=>d===this.currentStepName);u>=0&&(this.history=this.history.splice(0,u+1))}const h=this.steps[t];if(h&&!f.getValueOrDefault((i=h.options)==null?void 0:i.allowCyclicHistory,!1)&&this.history.filter(u=>u===t).length>0){const u=this.history.findIndex(d=>d===t);u>=0&&(this.history=this.history.splice(0,u+1))}}},this.dispatch=(t,e,o)=>{var x,H,k,v,P;this.logger("Flow > dispatch [start]",{actionName:e,payload:o,flow:this});let n=this.currentStepName?this.steps[this.currentStepName]:void 0,s,i=!1,r={flowName:void 0,stepName:void 0};const h=f.getValueOrDefault(n.options,{}),w=n==null?void 0:n.actions.hasOwnProperty(e),u=t.actions.includes(e)&&this.steps.hasOwnProperty(t.name),d=t.actions.includes(e)&&((x=this.anotherObjects)==null?void 0:x.hasOwnProperty(t.name));!w&&u?n=this.steps[t.name]:!w&&!u&&d&&(n=this.anotherObjects[t.name]),(w||u||d)&&(s=n.actions[e],typeof s=="string"?(i=this.currentStepName!==s,i&&this.treatHistory(s),this.currentStepName=s):(r=s()||{},this.treatHistory(r.stepName),(H=r==null?void 0:r.options)!=null&&H.history?this.history=(k=r==null?void 0:r.options)==null?void 0:k.history:(v=r==null?void 0:r.options)!=null&&v.clearHistory&&this.clearHistory(),r.stepName?this.currentStepName=r.stepName:this.currentStepName=this.currentStepName,i=!0));const O=((P=r.options)==null?void 0:P.clearHistory)||h.clearHistory||!1,F=h.ignoreHistory||!1;return i&&(this.lastAction="dispatch",this.callListeners("dispatch",{actionName:e,payload:o},{clearHistory:O,ignoreHistory:F})),this.logger("Flow > dispatch [end]",{nextStepNameOrFn:s,changed:i,flow:this}),{currentFlowName:r.flowName,currentStepName:r.stepName,changed:i,historyUrl:this.buildUrl(),clearHistory:O,ignoreHistory:F}},this.name=l,this.baseUrl=p,this.steps={},this.last2Steps={},this.history=[],this.listeners={all:[],back:[],backExit:[],dispatch:[],mount:[]}}get stepsArray(){return Object.keys(this.steps)}get firstStepName(){const l=this.stepsArray;return l.length>0?l[0]:void 0}get lastStepName(){return this.last2Steps[1]}get currentStepName(){return this.last2Steps[0]}set currentStepName(l){this.steps.hasOwnProperty(l)&&this.last2Steps[0]!==l&&(this.last2Steps[1]=this.last2Steps[0],this.last2Steps[0]=l)}};class K{constructor(l,p){return this.checkFlowExists=(t,e=!0)=>{const o=this.flows.hasOwnProperty(t);if(!o&&e)throw new Error(`The flow name "${t}" doesn't exists.`);return o},this.log=(t,...e)=>{D.log("Flow")(t,e)},this.flow=t=>{const{name:e,baseUrl:o}=t;return this.flows.hasOwnProperty(e)||(this.flows[e]=new G(e,o)),{steps:this.steps(t)}},this.getFlow=t=>this.flows[t],this.steps=({name:t,baseUrl:e})=>o=>{this.checkFlowExists(t);const n=this.getFlow(t);return Object.keys(o).forEach(s=>{const i=this.screens[s];this.log("steps",{screens:this.screens,screen:i,step:s}),n.addStep(i,s,o[s])}),this.log("flow",{flow:n}),{step:s=>(this.screens[s],i=>{Object.keys(i).forEach(r=>{const h=i[r];this.log("step",{screens:this.screens,steps:o,name:s,gotoScreen:h,screenActions:i}),n.addAction(s,r,h)}),this.log("flow final",{flow:n})}),anotherObject:s=>(this.anotherObjects[s],i=>{Object.keys(i).forEach(r=>{const h=i[r];this.log("anotherObject",{screens:this.screens,steps:o,name:s,gotoScreen:h,actions:i}),n.addAction(s,r,h,!0)}),this.log("flow final",{flow:n})}),listen:s=>{if(typeof s=="function"){const i=s;return n.addListener(i,"all")}else{const i=s;return n.addListener(i.callback,i.type)}},start:(s,i)=>({flowName:t,stepName:s,options:i}),navigateTo:(s,i)=>({flowName:t,stepName:s,options:i}),name:()=>t}},this.clearAllHistory=t=>{if(t){const e=this.getFlow(t);this.log("clearAllHistory",{flow:e,flowName:t}),e==null||e.clearHistory()}else Object.keys(this.flows).forEach(e=>{this.log("clearAllHistory",{flow:e}),this.getFlow(e).clearHistory()})},this._instance||(this.screens=l,this.anotherObjects=p,this.flows={},this._instance=this),this._instance}}const Q={screen1:{actions:["skip","next"],loader:()=>a.lazy(()=>N(()=>import("./screen1-DtBiQz1L.js"),__vite__mapDeps([2,1,3,4,5,6]),import.meta.url))},screen2:{actions:["next"],loader:()=>a.lazy(()=>N(()=>import("./screen2-D01pbWWe.js"),__vite__mapDeps([7,1,3,4,5,6]),import.meta.url))},screen3:{actions:["end"],loader:()=>a.lazy(()=>N(()=>import("./screen3-BuOZTEkB.js"),__vite__mapDeps([8,1,3,4,5,6]),import.meta.url))}},X={modalExample:{actions:["gotoStartScreen"]}},b=new K(Q,X),m=b.flow({name:"f0",baseUrl:"flows-example/f0"}).steps({screen1:{},screen2:{ignoreHistory:!0},screen3:{}});m.step("screen1")({next:"screen2",skip:"screen3"});m.step("screen2")({next:"screen3"});m.step("screen3")({end:"screen1"});m.anotherObject("modalExample")({gotoStartScreen:"screen1"});const E=b.flow({name:"f1",baseUrl:"flows-example/f1"}).steps({screen1:{},screen3:{}});E.step("screen1")({next:"screen3",skip:()=>(alert("Final step"),m.navigateTo("screen2"))});E.step("screen3")({end:()=>(alert("Final step"),m.navigateTo("screen2"))});const Y=b.flow({name:"f2",baseUrl:"flows-example/f2"}).steps({screen2:{}});Y.step("screen2")({next:()=>E.navigateTo()});m.listen({callback:c=>{console.log("listen back",{input:c})},type:"back"});m.listen({callback:c=>{console.log("listen dispatch",{input:c})},type:"dispatch"});m.listen({callback:c=>{console.log("listen mount",{input:c})},type:"mount"});const Z=()=>a.createElement("h1",null,"Only to working properly in storybook tree"),tt=$.writeStory({component:Z,group:"Modules"}),et={...tt.meta,title:"Modules/Flow"},st=()=>a.createElement(V,{fm:b,initialFlowName:"f2"}),y=st.bind({});y.args={children:a.createElement("h1",null,"Flow example")};const rt=()=>{const{currentFlowName:c}=q(),{back:l,hasPreviousStep:p}=W();return a.createElement("div",{style:{backgroundColor:c===m.name()?"red":"blue",color:"#fff",padding:"20px",borderRadius:"16px",margin:"0 0 24px 0"}},p()&&a.createElement("button",{onClick:l},"Back")," Top container")},it=()=>a.createElement("div",{style:{backgroundColor:"green",color:"#fff",padding:"20px",borderRadius:"16px",margin:"24px 0 0 0"}},"Bottom container"),ot=()=>a.createElement(V,{fm:b,initialFlowName:"f2",options:{animation:!1,withUrl:!1}},a.createElement(rt,null),a.createElement(_,null),a.createElement(it,null)),S=ot.bind({});S.args={children:a.createElement("h1",null,"Flow example")};var j,C,L;y.parameters={...y.parameters,docs:{...(j=y.parameters)==null?void 0:j.docs,source:{originalSource:'() => <FlowProvider fm={fm} initialFlowName="f2" />',...(L=(C=y.parameters)==null?void 0:C.docs)==null?void 0:L.source}}};var I,T,R;S.parameters={...S.parameters,docs:{...(I=S.parameters)==null?void 0:I.docs,source:{originalSource:`() => <FlowProvider fm={fm} initialFlowName="f2" options={{
  animation: false,
  withUrl: false
}}>
        <TopContainer />
        <StepRender />
        <BottomContainer />
    </FlowProvider>`,...(R=(T=S.parameters)==null?void 0:T.docs)==null?void 0:R.source}}};const nt=["Simple","CustomTemplate"],ut=Object.freeze(Object.defineProperty({__proto__:null,CustomTemplate:S,Simple:y,__namedExportsOrder:nt,default:et},Symbol.toStringTag,{value:"Module"}));export{ut as f,Q as s};
