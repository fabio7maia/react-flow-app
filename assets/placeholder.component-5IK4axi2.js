import{R as t}from"./index-D4lIrffr.js";import{L as T}from"./logger.helper-B8kJPxwa.js";class Z{static writeStory(l){const{component:s,args:p,group:m="General"}=l,c=n=>t.createElement(s,{...n}),r={};return p&&Object.keys(p).forEach(n=>{r[n]=c.bind({}),r[n].args=p[n]}),{meta:{title:`${m}/${s.displayName}`,component:s,decorators:[(n,C)=>n()]},template:c,stories:r}}}const S=e=>e,j=e=>{const{back:l,dispatch:s,currentFlowName:p,fm:m,refresh:c}=t.useContext(L),r=m==null?void 0:m.getFlow(p),n=t.useCallback((H,x)=>{s(e,H,x)},[s,e]),C=t.useCallback((r==null?void 0:r.getCurrentStep)||(()=>S()),[r]),V=t.useCallback((r==null?void 0:r.getHistory)||(()=>S([])),[r]),q=t.useCallback((r==null?void 0:r.getLastAction)||(()=>S()),[r]),o=t.useCallback((r==null?void 0:r.getPreviousStep)||(()=>S()),[r]),y=t.useCallback((r==null?void 0:r.hasPreviousStep)||(()=>S(!1)),[r]),i=t.useCallback((r==null?void 0:r.clearHistory)||(()=>S()),[r]);return t.useMemo(()=>({back:()=>{l==null||l()},clearHistory:i,dispatch:n,getCurrentStep:C,getHistory:V,getLastAction:q,getPreviousStep:o,hasPreviousStep:y,refresh:()=>{c==null||c()}}),[l,i,C,V,q,o,n,y,c])},ee=()=>{const{currentFlowName:e,start:l,fm:s}=t.useContext(L),p=t.useCallback(({flowName:m,stepName:c,options:r})=>{l(m,c,r)},[l]);return t.useMemo(()=>({currentFlowName:e,start:p,clearAllHistory:s.clearAllHistory}),[e,s.clearAllHistory,p])};try{j.displayName="useFlow",j.__docgenInfo={description:"",displayName:"useFlow",props:{actions:{defaultValue:null,description:"",name:"actions",required:!0,type:{name:"any"}},loader:{defaultValue:null,description:"",name:"loader",required:!1,type:{name:"() => LazyExoticComponent<ComponentType<any>>"}},url:{defaultValue:null,description:"",name:"url",required:!1,type:{name:"string"}}}}}catch{}const M=e=>t.useCallback(()=>({error:T.error(e),log:T.log(e),warn:T.error(e)}),[e])(),Q=()=>M("Flow");try{M.displayName="useLogger",M.__docgenInfo={description:"",displayName:"useLogger",props:{}}}catch{}const O={animation:!0,withUrl:!0},L=t.createContext({fm:void 0,currentFlowName:"",options:{animation:!1,withUrl:!1},start:(e,l,s)=>{},back:()=>{},dispatch:(e,l,s)=>{},refresh:()=>{}}),W=({fm:e,initialFlowName:l,children:s,initialStepName:p,options:m,onFlowMount:c,onFlowUnmount:r,listen:n,initialHistory:C})=>{var G;const[V,q]=t.useState(0),o=t.useRef(l),y=t.useRef(e.getFlow(o.current)),i=Q(),H=t.useRef(!1),{animation:x=O.animation,withUrl:R=O.withUrl}=m||O,A={animation:x,withUrl:R},N=t.useRef(void 0),F=t.useCallback(()=>{y.current=e.getFlow(o.current),q(a=>a+1)},[e]),v=t.useCallback(a=>{R&&(i.log("FlowProvider > updateLocationUrl",{url:`#${a}`}),a&&window.history.replaceState(null,null,`#${a}`))},[i,R]),g=t.useCallback((a,f,b,u,d=!1,w=!1)=>{var E;i.log("FlowProvider > handleStart",{flowName:a});const h=e.getFlow(a);u=u||(d?void 0:o.current);let P;if(u){const k=e.getFlow(u);P={flowName:k.name,stepName:(E=k.getCurrentStep())==null?void 0:E.name}}const{changed:I,historyUrl:U,currentFlowName:_}=(h==null?void 0:h.start(f,P,b,w,C))||{};if(I){if(_&&_!==a){const{fromFlow:k}=e.getFlow(_),K=k==null?void 0:k.flowName;return g(_,void 0,void 0,K,!0,w)}o.current=a,v(U),F()}},[e,F,C,i,v]),D=t.useCallback(()=>{var d;const{changed:a,currentFlowName:f,currentStepName:b,historyUrl:u}=((d=y.current)==null?void 0:d.back())||{};if(i.log("FlowProvider > back",{changed:a,currentFlowName:o}),a&&(n==null||n({currentStepName:"",flowName:o.current,type:"back",url:u})),a&&f!==o.current){const{fromFlow:w}=e.getFlow(f),h=w==null?void 0:w.flowName;g(f,b,void 0,h,!0,!0)}else a&&(v(u),F())},[e,F,g,n,i,v]),$=t.useCallback((a,f,b)=>{var U;const{changed:u,currentFlowName:d,currentStepName:w,historyUrl:h,clearHistory:P,ignoreHistory:I}=((U=y.current)==null?void 0:U.dispatch(a,f,b))||{};if(i.log("FlowProvider > dispatch",{name:f,payload:b,changed:u}),u&&(n==null||n({currentStepName:"",flowName:d||o.current,type:"dispatch",url:h,dispatch:{actionName:f,payload:b},options:{clearHistory:P,ignoreHistory:I}})),d&&d!==o.current)if(P){const{fromFlow:_}=e.getFlow(d),E=_==null?void 0:_.flowName;return g(d,w,void 0,E)}else return g(d,w);else u&&F();v(h)},[e,F,g,n,i,v]),z=t.useCallback(()=>{F()},[F]);H.current||(H.current=!0,g(o.current,p));const J=t.useMemo(()=>{var a;return{fm:e,currentFlowName:(a=y.current)==null?void 0:a.name,start:g,back:D,dispatch:$,refresh:z,options:A}},[e,D,$,z,g,A]);return t.useEffect(()=>{if(N.current&&N.current!==o.current&&r){const a=r[N.current];a==null||a()}if((!N.current||N.current!==o.current)&&c){N.current=o.current;const a=c[o.current];a==null||a()}},[V,e,c,r]),i.log("FlowProvider",{flow:y.current,currentFlowName:o.current,lastFlowName:N.current}),t.createElement(L.Provider,{value:J},s||((G=y.current)==null?void 0:G.render(A)))};try{L.displayName="flowManagerContext",L.__docgenInfo={description:"",displayName:"flowManagerContext",props:{}}}catch{}try{W.displayName="FlowProvider",W.__docgenInfo={description:"",displayName:"FlowProvider",props:{fm:{defaultValue:null,description:"",name:"fm",required:!0,type:{name:"FlowManager<any, any, any, any>"}},initialFlowName:{defaultValue:null,description:"",name:"initialFlowName",required:!0,type:{name:"string | number | symbol"}},initialStepName:{defaultValue:null,description:"",name:"initialStepName",required:!1,type:{name:"string"}},initialHistory:{defaultValue:null,description:"",name:"initialHistory",required:!1,type:{name:"string[]"}},options:{defaultValue:null,description:"",name:"options",required:!1,type:{name:"TFlowManagerOptions"}},onFlowMount:{defaultValue:null,description:"List of handlers by flows called when specific flow name is mounted",name:"onFlowMount",required:!1,type:{name:"Partial<Record<keyof TFlows, () => void>>"}},onFlowUnmount:{defaultValue:null,description:"List of handlers by flows called when specific flow name is unmounted",name:"onFlowUnmount",required:!1,type:{name:"Partial<Record<keyof TFlows, () => void>>"}},listen:{defaultValue:null,description:"",name:"listen",required:!1,type:{name:"(input: TFlowListenCallbackInput) => void"}}}}}catch{}const B=({children:e,loading:l})=>{const{log:s}=M("components");return s("Placeholder > render",{loading:l}),t.createElement(t.Fragment,null,l&&t.createElement("div",{className:"placeholder-load-wrapper"},t.createElement("div",{className:"placeholder-activity"})),!l&&t.createElement(t.Fragment,null,e))};try{B.displayName="Placeholder",B.__docgenInfo={description:"",displayName:"Placeholder",props:{loading:{defaultValue:null,description:"",name:"loading",required:!0,type:{name:"boolean"}},style:{defaultValue:null,description:"",name:"style",required:!1,type:{name:"CSSProperties"}}}}}catch{}export{W as F,B as P,Z as S,Q as a,ee as b,L as f,j as u};
